<!DOCTYPE HTML>
<html>
	<head>  
		<meta charset="UTF-8">
		<script src="lib/jquery-1.11.1.min.js"></script>
		<script>
	
        	jQuery.getJSON("https://pomber.github.io/covid19/timeseries.json", function(data){
                	maakGrafiek(data);
        	});


		function maakGrafiek(data) {

			var dataNL = [];
			var dataIT = [];
			var dataUK = [];
			var dataUS = [];

			correctie = -45;

			dag = 19;
			for (var i=1; i<data["Italy"].length; i++) {
				moment = data["Italy"][i];
				nlDate = new Date(moment.date);
				nlDate.setDate(nlDate.getDate()+12);
				nlDateFormatted = nlDate.getFullYear() + "-" + (nlDate.getMonth()+1) + "-"+nlDate.getDate();
				if(moment.deaths>0)
					dataIT.push({x: dag+correctie, y: moment.deaths/(60.48), toolTipContent: "Italië: "+moment.deaths+" doden ("+moment.date+") --> prognose Nederland: " + parseInt(moment.deaths*(17.18/60.48)) + " doden (" + nlDateFormatted + ")" });
				dag++;
			}

			dag = 7;
			for (var i=1; i<data["Netherlands"].length; i++) {
				moment = data["Netherlands"][i];
				if(moment.deaths>0)
					dataNL.push({x: dag+correctie, y: moment.deaths/(17.18), toolTipContent: "Nederland: "+moment.deaths+" doden ("+moment.date+")"});
				dag++;
			}

			dag = 3;
			for (var i=1; i<data["United Kingdom"].length; i++) {
				moment = data["United Kingdom"][i];
				if(moment.deaths>0)
					dataUK.push({x: dag+correctie, y: moment.deaths/(66.44), toolTipContent: "UK: "+moment.deaths+" doden ("+moment.date+")"});
				dag++;
			}

			dag = 0;
			for (var i=1; i<data["US"].length; i++) {
				moment = data["US"][i];
				if(moment.deaths>0)
					dataUS.push({x: dag+correctie, y: moment.deaths/(327.2), toolTipContent: "USA: "+moment.deaths+" doden ("+moment.date+")"});
				dag++;
			}

			var chart = new CanvasJS.Chart("chartContainer", {
				animationEnabled: true,
				title:{
					text: "Totaal aantal Corona-doden per miljoen inwoners.",
					fontSize: 26
				},
				axisX: {
					minimum: 5,
					title: "Start-momenten uitgelijnd.",
					includeZero: true,
					labelFontSize: 20,
					titleFontSize: 30
				},
				axisY: {
					minimum: 0.1,
					title: "doden per miljoen inwoners (logaritmisch)",
					valueFormatString: "#0.0",
					logarithmic: true,
					includeZero: true,
					labelFontSize: 20,
					logarithmBase: 10,
					titleFontSize: 20
				},
				legend:{
					cursor: "pointer",
					fontSize: 30,
					itemclick: toggleDataSeries
				},
				toolTip:{
					shared: true
				},
				data: [{
					name: "Italië",
					color: "green",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataIT,
				},
				{
					name: "Nederland",
					color: "orange",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataNL,
				},
				{
					name: "UK",
					color: "darkblue",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataUK,
				},
				{
					name: "USA",
					color: "red",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataUS,
				}]
			});
			chart.render();

			function toggleDataSeries(e){
				if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
					e.dataSeries.visible = false;
				}
				else{
					e.dataSeries.visible = true;
				}
				chart.render();
			}
		}
		</script>
	</head>
	<body>
		<div id="chartContainer" style="height: 800px; width: 800px;"></div>
		<script src="lib/canvasjs.min.js"></script>
	</body>
</html>
