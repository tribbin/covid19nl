<!DOCTYPE HTML>
<html>
	<head>  
		<meta charset="UTF-8">
		<script src="lib/jquery-1.11.1.min.js"></script>
		<script>

        	jQuery.getJSON("https://pomber.github.io/covid19/timeseries.json", function(data){
                	maakGrafiek(data);
        	});


		function maakGrafiek(data) {

			var dataNL = []; // Nederland
			var factorNL = []; // % verhoging
			var dataIT = []; // Italië
			var factorIT = []; // % verhoging
			var dataES = []; // Spanje
			var factorES = []; // % verhoging
			var dataFR = []; // Frankrijk
			var dataUK = []; // Verenigd Koninkrijk
			var dataUS = []; // Amerika
			var factorUS = []; // % verhoging
			var dataDE = []; // Duitsland
			var dataCN = []; // China

			correctie = -50; // Gehele tijdlijn-verschuiving, nadat de individuele landen onderling zijn uitgelijnd.

			dag = 19; // De tijdlijn-verschuiving van een land.
			for (var i=1; i<data["Italy"].length; i++) {
				moment = data["Italy"][i];
				factor = (moment.deaths / data["Italy"][i-1].deaths)-1;
				nlDate = new Date(moment.date);
				nlDate.setDate(nlDate.getDate()+12); // Italië loopt 12 dagen voor op de ontwikkelingen in Nederland.
				nlDateFormatted = nlDate.getFullYear() + "-" + (nlDate.getMonth()+1) + "-"+nlDate.getDate();
				if(moment.deaths>0) { // Negeer de tijd waarin er geen doden waren.
					dataIT.push(
						{
							x: dag+correctie, // Tijdsverschuiving om de 'ramp-up' van de verschillende landen gelijk te maken.
							y: moment.deaths/(60.48), // Gedeeld door het aantal miljoenen inwoners.
							toolTipContent: "Italië: "+moment.deaths
							+" doden ("+moment.date+") --> prognose Nederland: "
							+ parseInt(moment.deaths*(17.18/60.48)) // Het aantal doden per miljoen inwoners in Italië als prognose voor Nederland.
							+ " doden (" + nlDateFormatted + ")"
						}
					);
					factorIT.push(
						{
							x: dag+correctie,
							y: factor,
							toolTipContent: "Italië: {y} doden ("+moment.date+")"
						}
					);
				}
				dag++;
			}

			dag = 7;
			for (var i=1; i<data["Netherlands"].length; i++) {
				moment = data["Netherlands"][i];
				factor = (moment.deaths / data["Netherlands"][i-1].deaths)-1;
				if(moment.deaths>0) {
					dataNL.push({x: dag+correctie, y: moment.deaths/(17.18), toolTipContent: "Nederland: "+moment.deaths+" doden ("+moment.date+")"});
					factorNL.push(
						{
							x: dag+correctie,
							y: factor,
							toolTipContent: "Nederland: {y} doden ("+moment.date+")"
						}
					);
				}
				dag++;
			}

			dag = 9;
			for (var i=1; i<data["Spain"].length; i++) {
				moment = data["Spain"][i];
				factor = (moment.deaths / data["Spain"][i-1].deaths)-1;
				if(moment.deaths>0) {
					dataES.push({x: dag+correctie, y: moment.deaths/(46.66), toolTipContent: "Spanje: "+moment.deaths+" doden ("+moment.date+")"});
					factorES.push(
						{
							x: dag+correctie,
							y: factor,
							toolTipContent: "Spanje: {y} doden ("+moment.date+")"
						}
					);
				}
				dag++;
			}

			dag = 8;
			for (var i=1; i<data["France"].length; i++) {
				moment = data["France"][i];
				if(moment.deaths>0)
					dataFR.push({x: dag+correctie, y: moment.deaths/(66.99), toolTipContent: "Frankrijk: "+moment.deaths+" doden ("+moment.date+")"});
				dag++;
			}

			dag = 3;
			for (var i=1; i<data["United Kingdom"].length; i++) {
				moment = data["United Kingdom"][i];
				if(moment.deaths>0)
					dataUK.push({x: dag+correctie, y: moment.deaths/(66.44), toolTipContent: "UK: "+moment.deaths+" doden ("+moment.date+")"});
				dag++;
			}

			dag = 0;
			for (var i=1; i<data["US"].length; i++) {
				moment = data["US"][i];
				factor = (moment.deaths / data["US"][i-1].deaths)-1;
				if(moment.deaths>0) {
					dataUS.push({x: dag+correctie, y: moment.deaths/(327.2), toolTipContent: "USA: "+moment.deaths+" doden ("+moment.date+")"});
					factorUS.push(
						{
							x: dag+correctie,
							y: factor,
							toolTipContent: "Amerika: {y} doden ("+moment.date+")"
						}
					);
				}
				dag++;
			}

			dag = -1;
			for (var i=1; i<data["Germany"].length; i++) {
				moment = data["Germany"][i];
				if(moment.deaths>0)
					dataDE.push({x: dag+correctie, y: moment.deaths/(82.79), toolTipContent: "Duitsland: "+moment.deaths+" doden ("+moment.date+")"});
				dag++;
			}

			dag = 43;
			for (var i=1; i<data["China"].length; i++) {
				moment = data["China"][i];
				if(moment.deaths>0)
					dataCN.push({x: dag+correctie, y: moment.deaths/(1439), toolTipContent: "China*: "+moment.deaths+" doden ("+moment.date+")"});
				dag++;
			}

			var chart = new CanvasJS.Chart("chartContainer", {
				animationEnabled: true,
				title:{
					text: "Totaal aantal Corona-doden per miljoen inwoners.",
					fontSize: 26
				},
				subtitles:[
					{
						text: "Robin van Westrenen",
						fontSize: 12
					}
				],
				axisX: {
					minimum: 0,
					title: "Start-momenten uitgelijnd.",
					includeZero: true,
					labelFontSize: 20,
					titleFontSize: 20
				},
				axisY: {
					minimum: 0.1,
					title: "doden per miljoen inwoners (logaritmisch)",
					valueFormatString: "#0.0",
					logarithmic: true,
					includeZero: true,
					logarithmBase: 10,
					labelFontSize: 20,
					titleFontSize: 20
					},
				legend:{
					cursor: "pointer",
					fontSize: 30,
					itemclick: toggleDataSeries
				},
				toolTip:{
					shared: true
				},
				data: [{
					name: "Italië",
					color: "green",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataIT,
				},
				{
					name: "Nederland",
					color: "darkorange",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataNL,
				},
				{
					name: "Spanje",
					color: "pink",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataES,
				},
				{
					name: "Frankrijk",
					color: "darkcyan",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataFR,
				},
				{
					name: "UK",
					color: "darkblue",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataUK,
				},
				{
					name: "USA",
					color: "red",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataUS,
				},
				{
					name: "Duitsland",
					color: "black",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataDE,
				},
				{
					name: "China*",
					color: "brown",
					type: "spline",
					yValueFormatString: "##0",
					showInLegend: true,
					dataPoints: dataCN,
				}]
			});

			chart.render();

			var chart2 = new CanvasJS.Chart("chartContainer2", {
				animationEnabled: true,
				title:{
					text: "Groeifactor.",
					fontSize: 26
				},
				subtitles:[
					{
						text: "Robin van Westrenen",
						fontSize: 12
					}
				],
				axisX: {
					minimum: 5,
					title: "Start-momenten uitgelijnd.",
					includeZero: true,
					labelFontSize: 20,
					titleFontSize: 20
				},
				axisY: {
					minimum: 0,
					maximum: 1,
					title: "Procentuele groei sinds vorige dag.",
					valueFormatString: "+0%",
					includeZero: true,
					labelFontSize: 20,
					titleFontSize: 20
					},
				legend:{
					cursor: "pointer",
					fontSize: 30,
					itemclick: toggleDataSeries
				},
				toolTip:{
					shared: true
				},
				data: [{
					name: "Italië",
					color: "green",
					type: "spline",
					yValueFormatString: "+0.0%",
					showInLegend: true,
					dataPoints: factorIT
				},
				{
					name: "Nederland",
					color: "darkorange",
					type: "spline",
					yValueFormatString: "+0.0%",
					showInLegend: true,
					dataPoints: factorNL
				},
				{
					name: "Spanje",
					color: "pink",
					type: "spline",
					yValueFormatString: "+0.0%",
					showInLegend: true,
					dataPoints: factorES
				},
				{
					name: "USA",
					color: "red",
					type: "spline",
					yValueFormatString: "+0.0%",
					showInLegend: true,
					dataPoints: factorUS
				}]
			});

			chart2.render();

			function toggleDataSeries(e){
				if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
					e.dataSeries.visible = false;
				}
				else{
					e.dataSeries.visible = true;
				}
				chart.render();
				chart2.render();
			}
		}
		</script>
	</head>
	<body>
		<script src="lib/canvasjs.min.js"></script>
		<div id="chartContainer" style="height: 800px; width: 1200px;"></div>
		<br /><br />
		* De getallen m.b.t. China zijn niet betrouwbaar: <a href="https://nl.wikipedia.org/wiki/Coronapandemie#Kritiek_op_de_regionale_autoriteiten_in_China">https://nl.wikipedia.org/wiki/Coronapandemie#Kritiek_op_de_regionale_autoriteiten_in_China</a>
		<br /><br />
		<div id="chartContainer2" style="height: 800px; width: 1200px;"></div>
	</body>
</html>
